---
title: "wine"
author: "Curtis Easton"
date: "2024-11-20"
output: html_document
---

```{r setup}

options(repos = c(CRAN = "https://cloud.r-project.org"))

```

## load data

```{r}

# Load Necessary Libraries
library(dplyr) # For data manipulation

# Load the Red Wine Data
red_wine = read.csv("winequality-red.csv", sep = ";")

# Load the White Wine Data
white_wine = read.csv("winequality-white.csv", sep = ";")

# Add a Categorical Variable for Wine Type
red_wine$type = "Red"
white_wine$type = "White"

# Combine the Two Datasets
wine_data = bind_rows(red_wine, white_wine)

# Convert 'type' to a Factor
wine_data$type = as.factor(wine_data$type)

nrow(wine_data)

# View(wine_data)


```

## Additional Preliminary Overview of the Dataset

```{r}
table(wine_data$quality) # Distribution of `quality`
```


## Visualizations

```{r}

if (!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)

# Histogram of quality
ggplot(wine_data, aes(x = quality, fill = type)) +
  geom_bar(position = "dodge") +
  labs(title = "Distribution of Quality by Type", x = "Quality", y = "Count") +
  theme_minimal()
```

Comments:

`quality` values are concentrated around 5, 6, and 7.

White wines dominate `quality` score 6.

Red wines are nearly evenly split between `quality` scores 5 and 6.

```{r}
# Correlation matrix
if (!require(corrplot)) install.packages("corrplot")
library(corrplot)
numeric_data = wine_data %>%
  select(-type, -quality) # Considers numeric predictors only
cor_matrix = cor(numeric_data, use = "complete.obs")

# Visualize correlations
corrplot(cor_matrix, method = "color", addCoef.col = "black", 
         tl.cex = 0.8, number.cex = 0.7, main = "Correlation Heatmap")
```

Comments:

TODO: Insert comments about heatmap.


```{r}
# Histograms for numeric predictors
numeric_columns = names(numeric_data)
for (col in numeric_columns) {
  print(
    ggplot(wine_data, aes_string(x = col)) +
      geom_histogram(fill = "skyblue", color = "black", bins = 30) +
      labs(title = paste("Histogram of", col), x = col, y = "Frequency") +
      theme_minimal()
  )
}
```

Comments:

Some variables, like `fixed.acidity`, `citric.acid`, `alcohol`, and `pH`, show near-normal distributions, which is desirable.

Many numeric variables are skewed (including `volatile.acidity`, `residual.sugar`, `chlorides`, `sulphates`, `chlorides`, and `residual.sugar`). We'll consider transformations like log or square root.

## Exploring the Relationship Between Type and Quality

# Boxplot of quality by type
```{r}
ggplot(wine_data, aes(x = type, y = quality, fill = type)) +
  geom_boxplot() +
  labs(title = "Boxplot of Quality by Type", x = "Type", y = "Quality") +
  theme_minimal()
```

Comments:

The median values of `quality` are slightly different between red and white wines, with red wines having a smaller range of quality scores compared to white wines.


## Transforming Highly Skewed Variables

```{r}
# Log-transform skewed variables
wine_data = wine_data %>%
  mutate(
    log_residual_sugar = log1p(residual.sugar),  # Use log1p to handle 0 values
    log_chlorides = log1p(chlorides),
    log_sulphates = log1p(sulphates)
  )
```

## Visualizing Transformed Variables
```{r}
# Log-transformed residual sugar
ggplot(wine_data, aes(x = log_residual_sugar)) +
  geom_histogram(fill = "skyblue", color = "black", bins = 30) +
  labs(title = "Histogram of Log-Transformed Residual Sugar", 
       x = "Log(Residual Sugar + 1)", 
       y = "Frequency") +
  theme_minimal()
```

```{r}
# Log-transformed chlorides
ggplot(wine_data, aes(x = log_chlorides)) +
  geom_histogram(fill = "skyblue", color = "black", bins = 30) +
  labs(title = "Histogram of Log-Transformed Chlorides", 
       x = "Log(Chlorides + 1)", 
       y = "Frequency") +
  theme_minimal()
```

```{r}
# Log-transformed sulphates
ggplot(wine_data, aes(x = log_sulphates)) +
  geom_histogram(fill = "skyblue", color = "black", bins = 30) +
  labs(title = "Histogram of Log-Transformed Sulphates", 
       x = "Log(Sulphates + 1)", 
       y = "Frequency") +
  theme_minimal()
```

Comments:

We performed log transformations on the skewed variables, but the histograms of the transformations don't suggest the tranformation really improved the situation. Below, we'll compare two full models - one with original predictors and the other with log transformed predictors. Based on the histograms, our hunch is that the transformed predictors won't improve the model.

## Placeholder: Data Partitioning (for Predictive Models)
## Train-Test Data Split

```{r}
# Modified from Homework Week 11, Exercise 3
set.seed(420)
wine_trn_idx  = sample(nrow(wine_data), size = trunc(0.80 * nrow(wine_data)))
wine_trn_data = wine_data[wine_trn_idx, ]
wine_tst_data = wine_data[-wine_trn_idx, ]
wine_trn_data$type = as.factor(wine_trn_data$type)
wine_tst_data$type = as.factor(wine_tst_data$type)
```

## Fit a Full Additive Model
```{r}
lm_full_original = lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + 
    residual.sugar + chlorides + free.sulfur.dioxide + 
    total.sulfur.dioxide + density + pH + sulphates + 
    alcohol + type, data = wine_data)

summary(lm_full_original)
```

## Fit the Full Model with Transformed Variables
```{r}
lm_full_transformed = lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + 
    log_residual_sugar + log_chlorides + free.sulfur.dioxide + 
    total.sulfur.dioxide + density + pH + log_sulphates + 
    alcohol + type, data = wine_data)

summary(lm_full_transformed)
```

## Comparing Full Models (Original Variables vs. Transformed Variables)
```{r}
AIC(lm_full_original, lm_full_transformed)
BIC(lm_full_original, lm_full_transformed)
```

Comments:

As anticipated, the full model with transformed predictors is not better than the full model with original predictors.

For the two models, the differences between the Residual Standard Errors, the Adjusted R-squared, and F-Statistic are all negligible.

Both AIC and BIC slightly favor the original model over the transformed model.

