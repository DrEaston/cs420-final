---
title: "wine"
author: "Curtis Easton"
date: "2024-11-20"
output: html_document
---

```{r setup}

options(repos = c(CRAN = "https://cloud.r-project.org"))

```

## load data

```{r}

# Load Necessary Libraries
library(dplyr) # For data manipulation

# Load the Red Wine Data
red_wine = read.csv("winequality-red.csv", sep = ";")

# Load the White Wine Data
white_wine = read.csv("winequality-white.csv", sep = ";")

# Add a Categorical Variable for Wine Type
red_wine$type = "Red"
white_wine$type = "White"

# Combine the Two Datasets
wine_data = bind_rows(red_wine, white_wine)

# Convert 'type' to a Factor
wine_data$type = as.factor(wine_data$type)

nrow(wine_data)

# View(wine_data)


```

## Train-Test Data Split

```{r}
# Modified from Homework Week 11, Exercise 3
set.seed(420)
wine_trn_idx  = sample(nrow(wine_data), size = trunc(0.80 * nrow(wine_data)))
wine_trn_data = wine_data[wine_trn_idx, ]
wine_tst_data = wine_data[-wine_trn_idx, ]
wine_trn_data$type = as.factor(wine_trn_data$type)
wine_tst_data$type = as.factor(wine_tst_data$type)
```

## Data types


```{r}

str(wine_trn_data)

```



## Fit additive Model

```{r}

full_add_model = lm(quality ~ ., data = wine_trn_data) # Changed the name of this model to be more descriptive
summary(full_add_model)

```

## Pairs Plots

```{r}
library(faraway)
pairs(wine_trn_data, col = "dodgerblue")
```

## VIF Values


```{r}
if (!require(car)) install.packages("car")
library(car)

# Compute VIF Values
vif_values = vif(full_add_model)

# Display the VIF Values
vif_values


```

## Additional Collinearity and VIF Analysis

# Modified from Homework Week 11, Exercise 1

Fit a new model with the significant predictors. (Use $\alpha = 0.05$.) Calculate and report the variance inflation factor for each of the predictors. Do any of the VIFs suggest multicollinearity?

**Solution:**

```{r, solution = TRUE}
library(knitr)

significant_predictors = names(coef(full_add_model))[
  which(summary(full_add_model)$coefficients[, "Pr(>|t|)"] <= 0.05)
]
significant_predictors
```
```{r}
# Select Significant Predictors, Excluding Dummy Variable Artifacts
significant_predictors = names(coef(full_add_model))[
  which(summary(full_add_model)$coefficients[, "Pr(>|t|)"] <= 0.05)
]
significant_predictors = significant_predictors[significant_predictors != "(Intercept)"]

# Replace Any Dummy Variables with Original Factor Name
significant_predictors = gsub("type.*", "type", significant_predictors)# Select Significant Predictors, Excluding Dummy Variable Artifacts
significant_predictors = names(coef(full_add_model))[
  which(summary(full_add_model)$coefficients[, "Pr(>|t|)"] <= 0.05)
]
significant_predictors = significant_predictors[significant_predictors != "(Intercept)"]

# Replace Any Dummy Variables with Original Factor Name
significant_predictors = gsub("type.*", "type", significant_predictors)

# Remove Duplicates
significant_predictors = unique(significant_predictors)

# Create the Reduced Formula
reduced_formula = as.formula(
  paste("quality ~", paste(significant_predictors, collapse = " + "))
)


# Remove Duplicates
significant_predictors = unique(significant_predictors)

# Create the Reduced Formula
reduced_formula = as.formula(
  paste("quality ~", paste(significant_predictors, collapse = " + "))
)

reduced_formula
```

```{r}
reduced_model = lm(reduced_formula, data = wine_trn_data)
summary(reduced_model)
```
```{r}
vif_values = vif(reduced_model)
vif_table = data.frame(
  Predictor = names(vif_values),
  VIF = vif_values
)
rownames(vif_table) = NULL
kable(vif_table, col.names = c("Predictor", "Variance Inflation Factor"), 
      caption = "Variance Inflation Factor for Each Predictor in the Reduced Model")
```

**Insert comment on whether any VIF is higher than 5.**

Use an $F$-test to compare the full additive model and reduced model. Report the following:

- The null hypothesis
- The test statistic
- The distribution of the test statistic under the null hypothesis
- The p-value
- A decision
- Which model you prefer

**Solution:**

```{r, solution = TRUE}
anova(reduced_model, full_add_model)
```



Check the assumptions of the model. Do any assumptions appear to be violated?

**Solution:**

```{r, echo = FALSE}
plot_fitted_resid = function(model, pointcol = "dodgerblue", linecol = "darkorange") {
  plot(fitted(model), resid(model), 
       col = pointcol, pch = 20, cex = 1.5,
       xlab = "Fitted", ylab = "Residuals")
  abline(h = 0, col = linecol, lwd = 2)
}

plot_qq = function(model, pointcol = "dodgerblue", linecol = "darkorange") {
  qqnorm(resid(model), col = pointcol, pch = 20, cex = 1.5)
  qqline(resid(model), col = linecol, lwd = 2)
}
```

```{r, message = FALSE, warning = FALSE, solution = TRUE}
library(lmtest)
bptest(reduced_model)
par(mfrow = c(1, 2))
plot_fitted_resid(reduced_model)
plot_qq(reduced_model)
```



## Fit interaction model

```{r}


full_int_model = lm(quality ~ .^2, data = wine_trn_data) # Changed the name of this model to be more descriptive
summary(full_int_model)


```

## Including Plots


```{r}

# Histogram of Quality with Normal Distribution Overlay
hist(wine_trn_data$quality,
     breaks = 10,  # Adjust number of bins
     probability = TRUE,  # Scale histogram to show probabilities
     main = "Histogram of Wine Quality with Normal Distribution",
     xlab = "Wine Quality",
     col = "lightblue",
     border = "black")

# Calculate scaling factor for the normal curve
scale_factor = 0.8 / max(dnorm(x = seq(min(wine_trn_data$quality), max(wine_trn_data$quality), length = 100),
                               mean = mean(wine_trn_data$quality),
                               sd = sd(wine_trn_data$quality)))

# Overlay scaled normal distribution curve
curve(dnorm(x, mean = mean(wine_trn_data$quality), sd = sd(wine_trn_data$quality)) * scale_factor,
      col = "red",
      lwd = 2,
      add = TRUE)



# Scatter plot: Volatile Acidity vs Quality
plot(wine_trn_data$volatile.acidity, wine_trn_data$quality,
     main = "Volatile Acidity vs Wine Quality",
     xlab = "Volatile Acidity",
     ylab = "Wine Quality",
     col = "blue", pch = 19, cex = 0.5)

# Scatter plot: Residual Sugar vs Quality
plot(wine_trn_data$residual.sugar, wine_trn_data$quality,
     main = "Residual Sugar vs Wine Quality",
     xlab = "Residual Sugar",
     ylab = "Wine Quality",
     col = "green", pch = 19, cex = 0.5)


# Scatter plot: Fixed Acidity vs Quality
plot(wine_trn_data$fixed.acidity, wine_trn_data$quality,
     main = "Fixed Acidity vs Wine Quality",
     xlab = "Fixed Acidity",
     ylab = "Wine Quality",
     col = "purple", pch = 19, cex = 0.5)

# Scatter plot: Citric Acid vs Quality
plot(wine_trn_data$citric.acid, wine_trn_data$quality,
     main = "Citric Acid vs Wine Quality",
     xlab = "Citric Acid",
     ylab = "Wine Quality",
     col = "orange", pch = 19, cex = 0.5)

# Scatter plot: Chlorides vs Quality
plot(wine_trn_data$chlorides, wine_trn_data$quality,
     main = "Chlorides vs Wine Quality",
     xlab = "Chlorides",
     ylab = "Wine Quality",
     col = "red", pch = 19, cex = 0.5)

# Scatter plot: Free Sulfur Dioxide vs Quality
plot(wine_trn_data$free.sulfur.dioxide, wine_trn_data$quality,
     main = "Free Sulfur Dioxide vs Wine Quality",
     xlab = "Free Sulfur Dioxide",
     ylab = "Wine Quality",
     col = "cyan", pch = 19, cex = 0.5)

# Scatter plot: Total Sulfur Dioxide vs Quality
plot(wine_trn_data$total.sulfur.dioxide, wine_trn_data$quality,
     main = "Total Sulfur Dioxide vs Wine Quality",
     xlab = "Total Sulfur Dioxide",
     ylab = "Wine Quality",
     col = "brown", pch = 19, cex = 0.5)

# Scatter plot: Density vs Quality
plot(wine_trn_data$density, wine_trn_data$quality,
     main = "Density vs Wine Quality",
     xlab = "Density",
     ylab = "Wine Quality",
     col = "pink", pch = 19, cex = 0.5)

# Scatter plot: pH vs Quality
plot(wine_trn_data$pH, wine_trn_data$quality,
     main = "pH vs Wine Quality",
     xlab = "pH",
     ylab = "Wine Quality",
     col = "darkgreen", pch = 19, cex = 0.5)

# Scatter plot: Sulphates vs Quality
plot(wine_trn_data$sulphates, wine_trn_data$quality,
     main = "Sulphates vs Wine Quality",
     xlab = "Sulphates",
     ylab = "Wine Quality",
     col = "darkblue", pch = 19, cex = 0.5)

```


